{"id":"../node_modules/@ceramicnetwork/http-client/lib/document.js","dependencies":[{"name":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/lib/document.js.map","includedInParent":true,"mtime":1642247367859},{"name":"/home/vitalpointai/projects/space-gems/package.json","includedInParent":true,"mtime":1642266346920},{"name":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/package.json","includedInParent":true,"mtime":1642247367859},{"name":"rxjs","loc":{"line":7,"column":23},"parent":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/lib/document.js","resolved":"/home/vitalpointai/projects/space-gems/node_modules/rxjs/dist/esm5/index.js"},{"name":"rxjs/operators","loc":{"line":8,"column":28},"parent":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/lib/document.js","resolved":"/home/vitalpointai/projects/space-gems/node_modules/rxjs/dist/esm5/operators/index.js"},{"name":"@ceramicnetwork/common","loc":{"line":9,"column":25},"parent":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/lib/document.js","resolved":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/common/lib/index.js"},{"name":"@ceramicnetwork/streamid","loc":{"line":10,"column":27},"parent":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/lib/document.js","resolved":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/streamid/lib/index.js"},{"name":"query-string","loc":{"line":11,"column":47},"parent":"/home/vitalpointai/projects/space-gems/node_modules/@ceramicnetwork/http-client/lib/document.js","resolved":"/home/vitalpointai/projects/space-gems/node_modules/query-string/index.js"}],"generated":{"js":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Document = void 0;\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst common_1 = require(\"@ceramicnetwork/common\");\nconst streamid_1 = require(\"@ceramicnetwork/streamid\");\nconst query_string_1 = __importDefault(require(\"query-string\"));\nclass Document extends rxjs_1.Observable {\n    constructor(initial, _apiUrl, syncInterval) {\n        super((subscriber) => {\n            const isFirstObserver = this.state$.observers.length === 0;\n            if (isFirstObserver) {\n                this.periodicSubscription = rxjs_1.timer(0, syncInterval)\n                    .pipe(operators_1.throttle(() => this._syncState(this.id, { sync: common_1.SyncOptions.PREFER_CACHE })))\n                    .subscribe();\n            }\n            this.state$.subscribe(subscriber).add(() => {\n                var _a;\n                const isNoObserversLeft = this.state$.observers.length === 0;\n                if (isNoObserversLeft) {\n                    (_a = this.periodicSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n                }\n            });\n        });\n        this._apiUrl = _apiUrl;\n        this.state$ = new common_1.StreamStateSubject(initial);\n    }\n    get value() {\n        return this.state$.value;\n    }\n    get state() {\n        return this.state$.value;\n    }\n    next(state) {\n        this.state$.next(state);\n    }\n    async _syncState(streamId, opts) {\n        const state = await Document._load(streamId, this._apiUrl, opts);\n        this.state$.next(common_1.StreamUtils.deserializeState(state));\n    }\n    get id() {\n        return new streamid_1.StreamID(this.state$.value.type, this.state$.value.log[0].cid);\n    }\n    static async createFromGenesis(apiUrl, type, genesis, opts, syncInterval) {\n        const { state } = await common_1.fetchJson(apiUrl + '/streams', {\n            method: 'post',\n            body: {\n                type,\n                genesis: common_1.StreamUtils.serializeCommit(genesis),\n                opts,\n            },\n        });\n        return new Document(common_1.StreamUtils.deserializeState(state), apiUrl, syncInterval);\n    }\n    static async applyCommit(apiUrl, streamId, commit, opts, syncInterval) {\n        const { state } = await common_1.fetchJson(apiUrl + '/commits', {\n            method: 'post',\n            body: {\n                streamId: streamId.toString(),\n                commit: common_1.StreamUtils.serializeCommit(commit),\n                opts,\n            },\n        });\n        return new Document(common_1.StreamUtils.deserializeState(state), apiUrl, syncInterval);\n    }\n    static async _load(streamId, apiUrl, opts) {\n        const url = apiUrl + '/streams/' + streamId.toString() + '?' + query_string_1.default.stringify(opts);\n        const { state } = await common_1.fetchJson(url);\n        return state;\n    }\n    static async load(streamId, apiUrl, syncInterval, opts) {\n        const state = await Document._load(streamId, apiUrl, opts);\n        return new Document(common_1.StreamUtils.deserializeState(state), apiUrl, syncInterval);\n    }\n    static async loadStreamCommits(streamId, apiUrl) {\n        const { commits } = await common_1.fetchJson(`${apiUrl}/commits/${streamId}`);\n        return commits.map((r) => {\n            return {\n                cid: r.cid,\n                value: common_1.StreamUtils.deserializeCommit(r.value),\n            };\n        });\n    }\n    complete() {\n        this.state$.complete();\n    }\n}\nexports.Document = Document;\n"},"sourceMaps":{"js":{"version":3,"file":"document.js","sourceRoot":"","sources":["../src/document.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"9c960c959948a2fecb006f2cc8d5d9af","cacheData":{"env":{}}}